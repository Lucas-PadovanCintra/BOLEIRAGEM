<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 fw-bold text-dark">Gerenciamento de Contratos</h1>
    <%= link_to "Contratar Novo Jogador", new_player_contract_path, class: "btn btn-primary" %>
  </div>

  <!-- Contract Status Filters -->
  <div class="mb-4">
    <div class="btn-group" role="group">
      <button type="button" class="btn btn-success btn-sm">Todos os Contratos</button>
      <button type="button" class="btn btn-outline-secondary btn-sm">Ativos</button>
      <button type="button" class="btn btn-outline-secondary btn-sm">Expirados</button>
      <button type="button" class="btn btn-outline-secondary btn-sm">Expirando em Breve</button>
    </div>
  </div>

  <% if @player_contracts.any? %>
    <!-- Stats Cards -->
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <div class="card bg-success text-white">
          <div class="card-body text-center">
            <h4 class="fw-bold"><%= @player_contracts.where(is_expired: false).count %></h4>
            <small>Contratos Ativos</small>
          </div>
        </div>
      </div>
      <!--
      <div class="col-md-3">
        <div class="card bg-danger text-white">
          <div class="card-body text-center">
            <h4 class="fw-bold"><%= @player_contracts.where(is_expired: true).count %></h4>
            <small>Contratos Expirados</small>
          </div>
        </div>
      </div>
      -->
      <div class="col-md-4">
        <div class="card bg-warning text-white">
          <div class="card-body text-center">
            <h4 class="fw-bold"><%= @player_contracts.where(is_expired: false).select { |c| (c.contract_length - c.matches_played) <= 2 }.count %></h4>
            <small>Expirando em Breve</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card bg-info text-white">
          <div class="card-body text-center">
            <h4 class="fw-bold"><%= @player_contracts.count %></h4>
            <small>Total de Contratos</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Contracts Table -->
    <div class="card shadow-sm">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col" class="fw-bold text-muted small text-uppercase">Player</th>
              <th scope="col" class="fw-bold text-muted small text-uppercase">Team</th>
              <th scope="col" class="fw-bold text-muted small text-uppercase">Progresso do Contrato</th>
              <th scope="col" class="fw-bold text-muted small text-uppercase">Status</th>
              <th scope="col" class="fw-bold text-muted small text-uppercase">Data da Assinatura</th>
              <th scope="col" class="fw-bold text-muted small text-uppercase">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @player_contracts.includes(:player, :team).order(created_at: :desc).each do |contract| %>
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div>
                      <div class="fw-medium text-dark"><%= contract.player.name %></div>
                      <small class="text-muted">Rating: <%= contract.player.rating %></small>
                    </div>
                    <div class="ms-2">
                      <% (1..3).each do |i| %>
                        <% if i <= (contract.player.rating / 33.0).ceil %>
                          <i class="fas fa-star text-warning small"></i>
                        <% else %>
                          <i class="far fa-star text-muted small"></i>
                        <% end %>
                      <% end %>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="fw-medium"><%= contract.team.name %></span>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="me-2" style="min-width: 100px;">
                      <div class="progress" style="height: 6px;">
                        <div class="progress-bar bg-primary" role="progressbar"
                             style="width: <%= (contract.matches_played.to_f / contract.contract_length * 100).round(1) %>%"
                             aria-valuenow="<%= (contract.matches_played.to_f / contract.contract_length * 100).round(1) %>"
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                      </div>
                    </div>
                    <small class="text-muted"><%= contract.matches_played %>/<%= contract.contract_length %></small>
                  </div>
                </td>
                <td>
                  <% if (contract.contract_length - contract.matches_played) <= 2 %>
                    <span class="badge bg-warning text-dark">Expirando em Breve</span>
                  <% else %>
                    <span class="badge bg-success">Active</span>
                  <% end %>
                </td>
                <td class="text-muted">
                  <%= contract.created_at.strftime("%b %d, %Y") %>
                </td>
                <td>
                  <div class="btn-group btn-group-sm">
                    <%= link_to "Ver Contrato", contract, class: "btn btn-outline-primary btn-sm" %>
                    <%#= link_to "Edit", edit_player_contract_path(contract), class: "btn btn-outline-warning btn-sm" %>

                      <button class="btn btn-danger expire-contract-btn" data-contract-id="<%= contract.id %>" data-action="click->contracts#expire"
                      data-contract-redirect-url-value="/player_contracts" data-controller="contracts">
                        Expirar
                      </button>

                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% else %>
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="fas fa-file-contract text-muted" style="font-size: 4rem;"></i>
      </div>
      <h3 class="h4 fw-medium text-dark mb-2">Nenhum contrato assinado ainda</h3>
      <p class="text-muted mb-4">Comece a construir seu elenco contratando seu primeiro jogador!</p>
      <%= link_to "Contratar Primeiro Jogador", new_player_contract_path, class: "btn btn-primary btn-lg" %>
    </div>
  <% end %>
</div>
