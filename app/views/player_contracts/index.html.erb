<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 fw-bold text-dark">Gerenciamento de Contratos</h1>
    <%= link_to "Contratar Novo Jogador", players_path, class: "btn btn-primary" %>
  </div>

  <!-- Contract Status Filters -->
  <div class="mb-4">
    <%= form_with url: player_contracts_path, method: :get, local: true, class: "d-flex align-items-center" do %>
      <div class="btn-group" role="group">
        <%= submit_tag "Todos os Contratos", name: "status", value: "Todos", class: "btn btn-success btn-sm #{'active' if params[:status].blank? || params[:status] == 'all'}" %>
        <%= submit_tag "Ativos", name: "status", value: "Ativos", class: "btn btn-outline-secondary btn-sm #{'active' if params[:status] == 'active'}" %>
        <%= submit_tag "Expirando em Breve", name: "status", value: "Expirando em breve", class: "btn btn-outline-secondary btn-sm #{'active' if params[:status] == 'expiring_soon'}" %>
      </div>
    <% end %>
  </div>

  <!-- Contracts Summary -->
  <div class="card bg-light mb-4">
    <div class="card-body">
      <p class="text-muted mb-0">Custo Total de Contratos Ativos: <strong>ðŸ’°<%= number_with_delimiter(@player_contracts.sum('players.price')) %></strong></p>
    </div>
  </div>

  <!-- Contracts Table -->
  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col" class="fw-bold text-muted small text-uppercase">Jogador</th>
            <th scope="col" class="fw-bold text-muted small text-uppercase">Progresso do Contrato</th>
            <th scope="col" class="fw-bold text-muted small text-uppercase">Status</th>
            <th scope="col" class="fw-bold text-muted small text-uppercase">Data da Assinatura</th>
            <th scope="col" class="fw-bold text-muted small text-uppercase">AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          <% @player_contracts.includes(:player).order(created_at: :desc).each do |contract| %>
            <tr>
              <td>
                <%= link_to contract.player.name, player_path(contract.player), class: "fw-medium text-dark" %>
              </td>
              <td>
                <div class="d-flex align-items-center">
                  <div class="me-2" style="min-width: 100px;">
                    <div class="progress" style="height: 6px;">
                      <div class="progress-bar bg-primary" role="progressbar"
                           style="width: <%= (contract.matches_played.to_f / contract.contract_length * 100).round(1) %>%"
                           aria-valuenow="<%= (contract.matches_played.to_f / contract.contract_length * 100).round(1) %>"
                           aria-valuemin="0" aria-valuemax="100">
                      </div>
                    </div>
                  </div>
                  <small class="text-muted"><%= contract.matches_played %>/<%= contract.contract_length %></small>
                </div>
              </td>
              <td>
                <% if (contract.contract_length - contract.matches_played) <= 2 %>
                  <span class="badge bg-warning text-dark">Expirando em Breve</span>
                <% else %>
                  <span class="badge bg-success">Ativo</span>
                <% end %>
              </td>
              <td class="text-muted">
                <%= contract.created_at.strftime("%b %d, %Y") %>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <%= link_to "Ver Contrato", player_contract_path(contract), class: "btn btn-outline-primary btn-sm" %>
                  <button class="btn btn-danger btn-sm expire-contract-btn" data-contract-id="<%= contract.id %>" data-action="click->contracts#expire"
                          data-contract-redirect-url-value="/player_contracts" data-controller="contracts">
                    Expirar
                  </button>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <% unless @player_contracts.any? %>
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="fas fa-file-contract text-muted" style="font-size: 4rem;"></i>
      </div>
      <h3 class="h4 fw-medium text-dark mb-2">Nenhum contrato assinado ainda</h3>
      <p class="text-muted mb-4">Comece a construir seu elenco contratando seu primeiro jogador!</p>
      <%= link_to "Contratar Primeiro Jogador", players_path, class: "btn btn-primary btn-lg" %>
    </div>
  <% end %>
</div>
