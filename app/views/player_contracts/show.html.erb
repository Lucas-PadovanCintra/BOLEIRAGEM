<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 fw-bold text-dark">Detalhes do Contrato</h1>
    <div class="btn-group">
      <%#= link_to "Editar Contrato", edit_player_contract_path(@player_contract), class: "btn btn-warning" %>
      <%= link_to "Voltar aos Contratos", player_contracts_path, class: "btn btn-secondary" %>
    </div>
  </div>

  <!-- Contract Status Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm <%= @player_contract.is_expired ? 'border-danger' : 'border-success' %>">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h3 class="fw-bold text-dark mb-1"><%= @player_contract.player.name %></h3>
              <p class="text-muted mb-0">Contrato com <%= @player_contract.team.name %></p>
            </div>
            <div class="col-md-6 text-md-end">
              <% if @player_contract.is_expired %>
                <span class="badge bg-danger fs-6 mb-2">Contrato Expirado</span>
              <% elsif (@player_contract.contract_length - @player_contract.matches_played) <= 2 %>
                <span class="badge bg-warning text-dark fs-6 mb-2">Expirando em Breve</span>
              <% else %>
                <span class="badge bg-success fs-6 mb-2">Contrato Ativo</span>
              <% end %>
              <div class="mt-2">
                <div class="progress" style="height: 20px;">
                  <div class="progress-bar bg-primary" role="progressbar"
                       style="width: <%= (@player_contract.matches_played.to_f / @player_contract.contract_length * 100).round(1) %>%"
                       aria-valuenow="<%= (@player_contract.matches_played.to_f / @player_contract.contract_length * 100).round(1) %>"
                       aria-valuemin="0" aria-valuemax="100">
                    <%= (@player_contract.matches_played.to_f / @player_contract.contract_length * 100).round(1) %>%
                  </div>
                </div>
                <small class="text-muted"><%= @player_contract.matches_played %>/<%= @player_contract.contract_length %> partidas completadas</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Contract Information -->
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-bold text-dark mb-3">Detalhes do Contrato</h5>
          <div class="row g-2">
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">ID do Contrato:</span>
                <span class="fw-medium">#<%= @player_contract.id %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Data da Assinatura:</span>
                <span class="fw-medium"><%= @player_contract.created_at.strftime("%d de %B de %Y") %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Dura√ß√£o do Contrato:</span>
                <span class="fw-medium"><%= @player_contract.contract_length %> partidas</span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Partidas Jogadas:</span>
                <span class="fw-medium"><%= @player_contract.matches_played %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Partidas Restantes:</span>
                <span class="fw-medium <%= @player_contract.is_expired ? 'text-danger' : 'text-success' %>">
                  <%= [@player_contract.contract_length - @player_contract.matches_played, 0].max %>
                </span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Status:</span>
                <% if @player_contract.is_expired %>
                  <span class="badge bg-danger">Expirado</span>
                <% elsif (@player_contract.contract_length - @player_contract.matches_played) <= 2 %>
                  <span class="badge bg-warning text-dark">Expirando em Breve</span>
                <% else %>
                  <span class="badge bg-success">Ativo</span>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Player Information -->
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-bold text-dark mb-3">Perfil do Jogador</h5>
          <div class="text-center mb-3">
            <h4 class="fw-bold text-primary"><%= @player_contract.player.name %></h4>
            <div class="d-flex justify-content-center align-items-center mb-2">
              <span class="fs-3 fw-bold text-primary me-2"><%= @player_contract.player.rating %></span>
              <div class="d-flex">
                <% (1..5).each do |i| %>
                  <% if i <= (@player_contract.player.rating / 20.0).ceil %>
                    <i class="fas fa-star text-warning"></i>
                  <% else %>
                    <i class="far fa-star text-muted"></i>
                  <% end %>
                <% end %>
              </div>
            </div>
            <span class="fs-4 fw-bold text-success">üí∞<%= number_with_delimiter(@player_contract.player.price) %></span>
          </div>
          <div class="row g-2">
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">API ID:</span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Status no Mercado:</span>
                <% if @player_contract.player.is_on_market %>
                  <span class="badge bg-success">Dispon√≠vel</span>
                <% else %>
                  <span class="badge bg-danger">Contratado</span>
                <% end %>
              </div>
            </div>
          </div>
          <div class="mt-3 text-center">
            <%= link_to "Ver Perfil do Jogador", @player_contract.player, class: "btn btn-outline-primary btn-sm w-100" %>
          </div>
        </div>
      </div>
    </div>

    <!-- Team Information -->
    <div class="col-lg-4">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-bold text-dark mb-3">Informa√ß√µes do Time</h5>
          <div class="text-center mb-3">
            <h4 class="fw-bold text-dark"><%= @player_contract.team.name %></h4>
            <small class="text-muted">Propriet√°rio: <%= @player_contract.team.user.email.split('@').first.capitalize %></small>
          </div>
          <div class="row g-2">
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Total de Jogadores:</span>
                <span class="fw-medium"><%= @player_contract.team.players.count %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Contratos Ativos:</span>
                <span class="fw-medium"><%= @player_contract.team.player_contracts.where(is_expired: false).count %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Partidas Jogadas:</span>
                <span class="fw-medium"><%= @player_contract.team.matches.count %></span>
              </div>
            </div>
          </div>
          <div class="mt-3 text-center">
            <%= link_to "Ver Perfil do Time", @player_contract.team, class: "btn btn-outline-success btn-sm w-100" %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- A√ß√µes do Contrato -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm border-info">
        <div class="card-body">
          <h5 class="card-title fw-bold text-info mb-3">
            <i class="fas fa-cog me-2"></i>A√ß√µes do Contrato
          </h5>
          <div class="d-flex gap-2 flex-wrap">
            <%# link_to "Editar Contrato", edit_player_contract_path(@player_contract), class: "btn btn-warning" %>

              <button class="btn btn-danger expire-contract-btn" data-contract-id="<%= @player_contract.id %>" data-action="click->contracts#expire"
              data-contract-redirect-url-value="/player_contracts" data-controller="contracts">
                Expirar Contrato
              </button>

              <%# button class: "btn btn-success", onclick: "renewContract(#{@player_contract.id})" do %>
                <%# Renovar Contrato %>
              <%# end %>
              <%# button class: "btn btn-success", onclick: "renewContract(#{@player_contract.id})" do %>
                <%# Recontratar Jogador %>
              <%# end %>
            <%# link_to "Deletar Contrato", @player_contract,
                data: { turbo_method: :delete, turbo_confirm: "Tem certeza que deseja deletar este contrato?" },
                class: "btn btn-outline-danger" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
