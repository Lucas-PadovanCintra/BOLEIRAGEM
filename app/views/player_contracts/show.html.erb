<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 fw-bold text-dark">Detalhes do Contrato</h1>
    <div class="btn-group">
      <%= link_to "Voltar aos Contratos", player_contracts_path, class: "btn btn-secondary" %>
    </div>
  </div>

  <!-- Contract Status Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm <%= @player_contract.is_expired ? 'border-danger' : 'border-success' %>">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h3 class="fw-bold text-dark mb-1"><%= link_to @player_contract.player.name, player_path(@player_contract.player) %></h3>
              <p class="text-muted mb-0">Contrato com <%= link_to @player_contract.team.name, team_path(@player_contract.team) %></p>
            </div>
            <div class="col-md-6 text-md-end">
              <% if @player_contract.is_expired %>
                <span class="badge bg-secondary fs-6 mb-2">Contrato Expirado</span>
              <% elsif (@player_contract.contract_length - @player_contract.matches_played) <= 2 %>
                <span class="badge bg-warning text-dark fs-6 mb-2">Expirando em Breve</span>
              <% else %>
                <span class="badge bg-success fs-6 mb-2">Contrato Ativo</span>
              <% end %>
              <div class="mt-2">
                <div class="progress" style="height: 20px;">
                  <div class="progress-bar bg-primary" role="progressbar"
                       style="width: <%= (@player_contract.matches_played.to_f / @player_contract.contract_length * 100).round(1) %>%"
                       aria-valuenow="<%= (@player_contract.matches_played.to_f / @player_contract.contract_length * 100).round(1) %>"
                       aria-valuemin="0" aria-valuemax="100">
                    <%= (@player_contract.matches_played.to_f / @player_contract.contract_length * 100).round(1) %>%
                  </div>
                </div>
                <small class="text-muted"><%= @player_contract.matches_played %>/<%= @player_contract.contract_length %> partidas completadas</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <!-- Contract Information -->
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-bold text-dark mb-3">Detalhes do Contrato</h5>
          <div class="row g-2">
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">ID do Contrato:</span>
                <span class="fw-medium">#<%= @player_contract.id %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Data da Assinatura:</span>
                <span class="fw-medium"><%= @player_contract.created_at.strftime("%d de %B de %Y") %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Duração do Contrato:</span>
                <span class="fw-medium"><%= @player_contract.contract_length %> partidas</span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Partidas Jogadas:</span>
                <span class="fw-medium"><%= @player_contract.matches_played %></span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Partidas Restantes:</span>
                <span class="fw-medium <%= @player_contract.is_expired ? 'text-danger' : 'text-success' %>">
                  <%= [@player_contract.contract_length - @player_contract.matches_played, 0].max %>
                </span>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between">
                <span class="text-muted">Status:</span>
                <% if @player_contract.is_expired %>
                  <span class="badge bg-secondary">Expirado</span>
                <% elsif (@player_contract.contract_length - @player_contract.matches_played) <= 2 %>
                  <span class="badge bg-warning text-dark">Expirando em Breve</span>
                <% else %>
                  <span class="badge bg-success">Ativo</span>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Contract Matches -->
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-bold text-dark mb-3">Partidas do Contrato</h5>
          <% if @player_contract.matches.any? %>
            <div class="list-group list-group-flush">
              <% @player_contract.matches.order(created_at: :desc).each do |match| %>
                <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                  <div>
                    <div class="fw-medium">Partida #<%= match.id %></div>
                    <small class="text-muted"><%= match.created_at.strftime("%d de %B de %Y") %></small>
                  </div>
                  <div>
                    <% if match.is_simulated %>
                      <% if match.draw? %>
                        <span class="badge bg-warning text-dark">Empate</span>
                      <% elsif match.winner_team && match.winner_team.user_id == current_user.id %>
                        <span class="badge bg-success">Vitória</span>
                      <% else %>
                        <span class="badge bg-danger">Derrota</span>
                      <% end %>
                    <% else %>
                      <span class="badge bg-secondary">Pendente</span>
                    <% end %>
                    <%= link_to "Ver", match_path(match), class: "btn btn-outline-primary btn-sm ms-2" %>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-4">
              <p class="text-muted mb-0">Nenhuma partida registrada para este contrato.</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Ações do Contrato -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm border-info">
        <div class="card-body">
          <h5 class="card-title fw-bold text-info mb-3">
            <i class="fas fa-cog me-2"></i>Ações do Contrato
          </h5>
          <div class="d-flex gap-2 flex-wrap">
            <button class="btn btn-danger expire-contract-btn" data-contract-id="<%= @player_contract.id %>" data-action="click->contracts#expire"
                    data-contract-redirect-url-value="/player_contracts" data-controller="contracts">
              Expirar Contrato
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
