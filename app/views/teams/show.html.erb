<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 fw-bold text-dark"><%= @team.name %></h1>
        <div class="btn-group">
          <%= link_to "Editar Time", edit_team_path(@team), class: "btn btn-primary" %>
          <%= link_to "Voltar aos Times", teams_path, class: "btn btn-secondary" %>
        </div>
      </div>

      <!-- Team Statistics -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <h5 class="fw-bold text-dark mb-3 border-bottom pb-2">
                <i class="fas fa-chart-bar me-2"></i>Estatísticas do Time
              </h5>
            </div>
            <div class="col-12">
              <div class="card bg-light">
                <div class="card-body">
                  <div class="row g-3 text-center">
                    <div class="col-md-3">
                      <div class="border-end border-2">
                        <h4 class="fw-bold text-primary mb-0"><%= @team.player_contracts.where(is_expired: false).count %></h4>
                        <small class="text-muted">Jogadores Ativos</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="border-end border-2">
                        <h4 class="fw-bold text-success mb-0"><%= @team.matches.count %></h4>
                        <small class="text-muted">Partidas Jogadas</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="border-end border-2">
                        <h4 class="fw-bold text-info mb-0"><%= @team.matches.where(result: 'Vitória').count %></h4>
                        <small class="text-muted">Vitórias</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <h4 class="fw-bold text-warning mb-0"><%= @team.player_contracts.count %></h4>
                      <small class="text-muted">Total de Contratos</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Squad Management -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                <h5 class="fw-bold text-dark mb-0">
                  <i class="fas fa-users me-2"></i>Elenco
                </h5>
                <%= link_to "Contratar Jogador", new_player_contract_path, class: "btn btn-success btn-sm" %>
              </div>
            </div>

            <div class="col-12">
              <% if @team.player_contracts.where(is_expired: false).any? %>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead class="table-light">
                      <tr>
                        <th class="fw-bold text-dark">Jogador</th>
                        <th class="fw-bold text-dark">Rating</th>
                        <th class="fw-bold text-dark">Progresso do Contrato</th>
                        <th class="fw-bold text-dark">Status</th>
                        <th class="fw-bold text-dark">Ações</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @team.player_contracts.where(is_expired: false).includes(:player).each do |contract| %>
                        <tr>
                          <td>
                            <div class="fw-bold text-dark"><%= contract.player.name %></div>
                          </td>
                          <td class="text-dark">
                            <%= contract.player.rating %>
                          </td>
                          <td>
                            <div class="progress mb-1" style="height: 6px;">
                              <div class="progress-bar bg-primary" style="width: <%= (contract.matches_played.to_f / contract.contract_length * 100).round(1) %>%"></div>
                            </div>
                            <small class="text-muted"><%= contract.matches_played %>/<%= contract.contract_length %> partidas</small>
                          </td>
                          <td>
                            <% if contract.is_expired %>
                              <span class="badge bg-danger">Expirado</span>
                            <% elsif (contract.contract_length - contract.matches_played) <= 2 %>
                              <span class="badge bg-warning text-dark">Expirando</span>
                            <% else %>
                              <span class="badge bg-success">Ativo</span>
                            <% end %>
                          </td>
                          <td>
                            <div class="btn-group btn-group-sm">
                              <%= link_to "Ver", contract, class: "btn btn-outline-primary btn-sm" %>
                              <%= link_to "Editar", edit_player_contract_path(contract), class: "btn btn-outline-warning btn-sm" %>
                            </div>
                          </td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <div class="text-center py-4">
                  <p class="text-muted mb-3">Nenhum jogador no seu elenco ainda.</p>
                  <%= link_to "Contratar Seu Primeiro Jogador", new_player_contract_path, class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Matches -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                <h5 class="fw-bold text-dark mb-0">
                  <i class="fas fa-futbol me-2"></i>Partidas Recentes
                </h5>
                <%= link_to "Nova Partida", new_match_path, class: "btn btn-success btn-sm" %>
              </div>
            </div>

            <div class="col-12">
              <% if @team.matches.any? %>
                <% recent_matches = @team.matches.order(created_at: :desc).limit(5) %>
                <div class="list-group list-group-flush">
                  <% recent_matches.each do |match| %>
                    <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                      <div>
                        <div class="fw-medium">Match #<%= match.id %></div>
                        <small class="text-muted">
                          <%= match.created_at.strftime("%d de %B de %Y") %>
                        </small>
                      </div>
                      <div>
                        <% if match.result.present? %>
                          <% case match.result %>
                          <% when 'Vitória' %>
                            <span class="badge bg-success"><%= match.result %></span>
                          <% when 'Derrota' %>
                            <span class="badge bg-danger"><%= match.result %></span>
                          <% when 'Empate' %>
                            <span class="badge bg-warning text-dark"><%= match.result %></span>
                          <% else %>
                            <span class="badge bg-primary"><%= match.result %></span>
                          <% end %>
                        <% else %>
                          <span class="badge bg-secondary">Pendente</span>
                        <% end %>
                        <%= link_to "Ver", match, class: "btn btn-outline-primary btn-sm ms-2" %>
                      </div>
                    </div>
                  <% end %>
                </div>

                <div class="text-center mt-3">
                  <%= link_to "Ver Todas as Partidas", matches_path, class: "btn btn-outline-primary" %>
                </div>
              <% else %>
                <div class="text-center py-4">
                  <p class="text-muted mb-3">Nenhuma partida jogada ainda.</p>
                  <%= link_to "Criar Primeira Partida", new_match_path, class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Team Information -->
      <div class="card border-info">
        <div class="card-body">
          <h6 class="card-title fw-bold text-info">
            <i class="fas fa-info-circle me-2"></i>Informações do Time
          </h6>
          <div class="row">
            <div class="col-md-6">
              <p class="mb-1"><strong>Proprietário:</strong> <%= @team.user.email %></p>
              <p class="mb-1"><strong>Criado em:</strong> <%= @team.created_at.strftime("%d de %B de %Y às %H:%M") %></p>
            </div>
            <div class="col-md-6">
              <p class="mb-1"><strong>Total de Jogadores:</strong> <%= @team.player_contracts.count %></p>
              <p class="mb-1"><strong>Jogadores Ativos:</strong> <%= @team.player_contracts.where(is_expired: false).count %></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
