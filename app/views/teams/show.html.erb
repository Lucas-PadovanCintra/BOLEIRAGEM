<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 fw-bold text-dark"><%= @team.name %></h1>
        <div class="btn-group">
          <%= link_to "Editar Time", edit_team_path(@team), class: "btn btn-primary" %>
          <%= link_to "Voltar aos Times", teams_path, class: "btn btn-secondary" %>
        </div>
      </div>

      <!-- Team Statistics -->
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <h5 class="fw-bold text-dark mb-3 border-bottom pb-2">
                <i class="fas fa-chart-bar me-2"></i>Estatísticas do Time
              </h5>
            </div>
            <div class="col-12">
              <div class="card bg-light">
                <div class="card-body">
                  <div class="row g-3 text-center">
                    <div class="col-md-3">
                      <div class="border-end border-2">
                        <h4 class="fw-bold text-primary mb-0"><%= @team.player_contracts.where(is_expired: false).count %></h4>
                        <small class="text-muted">Jogadores Ativos</small>
                        <%= link_to "Ver Elenco", "#elenco", class: "btn btn-link btn-sm" %>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="border-end border-2">
                        <h4 class="fw-bold text-success mb-0"><%= @team.matches.count %></h4>
                        <small class="text-muted">Partidas Jogadas</small>
                        <%= link_to "Ver Partidas", "#partidas", class: "btn btn-link btn-sm" %>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="border-end border-2">
                        <h4 class="fw-bold text-info mb-0"><%= @team.matches.where(result: 'Vitória').count %></h4>
                        <small class="text-muted">Vitórias</small>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <h4 class="fw-bold text-warning mb-0"><%= @team.player_contracts.count %></h4>
                      <small class="text-muted">Total de Contratos</small>
                      <%= link_to "Ver Contratos", player_contracts_path, class: "btn btn-link btn-sm" %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Squad Management -->
      <div class="card shadow-sm mb-4" id="elenco">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                <h5 class="fw-bold text-dark mb-0">
                  <i class="fas fa-users me-2"></i>Elenco
                </h5>
                <%= link_to "Contratar Jogador", players_path, class: "btn btn-success btn-sm" %>
              </div>
            </div>

            <div class="col-12">
              <% if @team.player_contracts.where(is_expired: false).any? %>
                <%= render 'player_table' %>
                </div>
                <div class="mt-3">
                  <p class="text-muted">Média de Rating do Elenco: <strong><%= @avarege_rating %></strong></p>
                </div>
              <% else %>
                <div class="text-center py-4">
                  <p class="text-muted mb-3">Nenhum jogador no seu elenco ainda.</p>
                  <%= link_to "Contratar Seu Primeiro Jogador", players_path, class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Matches -->
      <div class="card shadow-sm mb-4" id="partidas">
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
                <h5 class="fw-bold text-dark mb-0">
                  <i class="fas fa-futbol me-2"></i>Partidas Recentes
                </h5>
              </div>
            </div>

            <div class="col-12">
              <% if @team.matches.any? %>
                <% recent_matches = @team.matches.order(created_at: :desc).limit(5) %>
                <div class="list-group list-group-flush">
                  <% recent_matches.each do |match| %>
                    <div class="list-group-item d-flex justify-content-between align-items-center px-0">
                      <div>
                        <div class="fw-medium">Partida #<%= match.id %></div>
                        <small class="text-muted">
                          <%= match.created_at.strftime("%d de %B de %Y") %>
                        </small>
                      </div>
                      <div>
                        <% if match.is_simulated %>
                          <% if match.draw? %>
                            <span class="badge bg-warning text-dark">Empate</span>
                          <% elsif match.winner_team && match.winner_team.user_id == current_user.id %>
                            <span class="badge bg-success">Vitória</span>
                          <% else %>
                            <span class="badge bg-danger">Derrota</span>
                          <% end %>
                        <% else %>
                          <span class="badge bg-secondary">Pendente</span>
                        <% end %>
                        <%= link_to "Ver", match, class: "btn btn-outline-primary btn-sm ms-2" %>
                      </div>
                    </div>
                  <% end %>
                </div>

                <div class="text-center mt-3">
                  <%= link_to "Ver Todas as Partidas", matches_path, class: "btn btn-outline-primary" %>
                </div>
              <% else %>
                <div class="text-center py-4">
                  <p class="text-muted mb-3">Nenhuma partida jogada ainda.</p>
                  <%= link_to "Ver Partidas", matches_path, class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Team Information -->
      <div class="card border-info">
        <div class="card-body">
          <h6 class="card-title fw-bold text-info">
            <i class="fas fa-info-circle me-2"></i>Informações do Time
          </h6>
          <div class="row">
            <div class="col-md-6">
              <p class="mb-1"><strong>Proprietário:</strong> <%= @team.user.email %></p>
              <p class="mb-1"><strong>Criado em:</strong> <%= @team.created_at.strftime("%d de %B de %Y às %H:%M") %></p>
            </div>
            <div class="col-md-6">
              <p class="mb-1"><strong>Descrição:</strong> <%= @team.description || 'Sem descrição' %></p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
